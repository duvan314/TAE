---
title: "Untitled"
author: "daniela vasco ruiz"
date: "26/11/2021"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Planteamiento del problema

**Introducción**

La accidentalidad en Medellín es un problema actual en el cual como ciudadanos debemos buscar soluciones para disminuir los incidentes viales.El objetivo de este trabajo es predecir la accidentalidad de la ciudad de Medellín mediante modelos predictivos para pronosticar la accidentalidad en años posteriores por tipo de accidente a nivel semanal,mensual y diario considerando fechas especiales como feria de flores, festivos y meses lluviosos.Por medio de la base de datos incidentes viales del portal MeData "http://medata.gov.co/dataset/incidentes-viales" se tiene informacion suministrada por la Secretaría de Movilidad de la Alcaldía de Medellín sobre incidentes de transito desde julio del 2014 hasta agosto del 2020, con estos datos se procede a analizar, depurar y desarrollar tecnicas de aprendizaje estadistico para la elaboracion del trabajo.

Esta base de datos se descargo el 8 de noviembre del 2021 en formato excel.CSV, analizando los datos se observa que contiene 270765 registros y 17 variables donde la variable GRAVEDAD_ACCIDENTE no se encontraba y su informacion se encontraba suministra en la variable MES, es decir,la informacion estaba desplazada una columna hacia la izquierda. Las variables son las siguientes:

AÑO: Año de ocurrencia del incidente.

CBML: Código catastral que corresponde al código comuna, barrio, manzana, lote catastral de un predio.

clase de accidente de tránsito: choque, atropello, volcamiento, caída de ocupante, incendio, u otro (que no corresponde a las anteriores 5 clasificaciones, p. ej: sumersión).

DIRECCION: Dirección donde ocurrió el incidente.

DIRECCION ENCASILLADA: Dirección encasillada que entrega el geocodificador.

DISENO: Sitio de la vía donde ocurrió el accidente: Cicloruta, Glorieta, Interseccion, Lote o Predio, Paso a Nivel, Paso Elevado, Paso Inferior, Pontón, Puente, Tramo de via, Tunel, Via peatonal.

EXPEDIENTE: Consecutivo que asigna UNE, según el orden de llegada de los expedientes para su diligenciamiento.

FECHA_ACCIDENTE: Fecha del accidente, proviene del IPAT - Informe Policial de accidente de Tránsito.

FECHA_ACCIDENTES: Fecha de los accidente (formato YYYY-MM-DD hh:mi:ss), proviene del IPAT - Informe Policial de accidentes de Tránsito.

GRAVEDAD_ACCIDENTE: Clasificación del IPAT - Informe Policial de Accidentes de Tránsito, sobre la gravedad del accidente, corresponde al resultado más grave presentado en el accidente. Daños materiales "Sólo daños", accidente con heridos "Herido", accidente con muertos "Muerto". No indica cantidad	true.

MES: Mes de ocurrencia del incidente vial.

NRO_RADICADO: Consecutivo que asigna UNE, según el orden de llegada de los expedientes para su diligenciamiento.

NUMCOMUNA: Número de la comuna en la que ocurrio incidente vial.

COMUNA: Denominación con la cual se identifica cada Comuna o Corregimiento. 01:Popular 02:Santa Cruz 03:Manrique 04:Aranjuez 05:Castilla 06:Doce de Octubre 07:Robledo 08:Villa Hermosa 09:Buenos Aires 10:La Candelaria 11:Laureles - Estadio 12:La América 13:San Javier 14:El Poblado 15:Guayabal 16:Belén 50:San Sebastián de Palmitas 60:San Cristobal 70:Altavista 80:San Antonio de Prado 90:Santa Elena 99:Toda la Ciudad.

LOCATION: Fuente de información con la cual se realizó la geocodificación.

X: Coordenada X en metros del accidente, en sistema de coordenadas MAGNA Medellín Local.

Y: Coordenada Y en metros del accidente, en sistema de coordenadas MAGNA Medellín Local.


```{r}
library(readxl)
datos <- read_excel("~/GitHub/TAE/Trabajo 1/datos/incidentes_viales.xlsx")
attach(datos)
```

**Datos Faltantes**


```{r}
library(kableExtra)
kable(apply(is.na(datos), 2, sum),caption = "Tabla de informacion faltante por variable") 
```


**Preprocesamiento de los datos**

Para mejorar los datos originales se modificaron registros que estaban escritos incorrectamente en las siguientes variables: CLASE_ACCIDENTE, DISENO,COMUNA, BARRIO y GRAVEDAD_ACCIDENTE.

La variable FECHA_ACCIDENTES se modifico en formato año-mes-dia-hora-minutos-segundos.

En COMUNA la informacion suministrada como (0, AU, IN, SN, No georef, Sin Inf) se agruparon en los NA.

Analizando la variable  BARRIO se visualiza que algunos aparecen con sus nombres y otros con su número, por medio de una base de datos externa de la alcaldia de Medellín verificada por el D.N.P (Departamiento Nacional de Planeacion) se reemplazaron estos números y se asignó su respectivo nombre. Para el análisis solo se tuvieron en cuenta los barrios y se excluyeron los corregimientos.

Las coordenadas 6.22141524356,-75.7037762763 de la variable LOCATION se encuentran fuera de Medellín,  por tanto no se tuvieron en cuenta en el desarrollo del trabajo. Esta variable se separo para crear dos variables  LATITUD y LONGITUD.

Excluimos de la variable CLASE_ACCIDENTE la categoría incendio ya que solo contaba con 24 registros.

Finalmente la base de datos limpia contiene  242456 registros y 12 variables que son:
CLASE_ACCIDENTE,GRAVEDAD_ACCIDENTE,DISEÑO,COMUNA,BARRIO,LATITUD,LONGITUD,FECHA_ACCIDENTES,AÑO,MES,DIA_MES y DIA.

**Añadir que porcentaje de los datos estamos descartando**

En donde realizando las depuración y reorganizando la informacion  adecuadamente para el entendimiento de la base de datos se elimino aproximadamente 10.45% de los registros de la base de datos original, con la informacion mencionada anteriormente es con la que realizaremos las predicciones requeridas.
            

```{r}
datos_listos_final <-read.csv("C:\\Users\\DANIELA\\Desktop\\datos\\datos_listos_final.csv",header=T,sep = ";")
```


**Analisis descriptivo**

```{r}
library(ggplot2)
ggplot(data = datos_listos_final) +
  geom_bar(mapping = aes(as.factor(CLASE_ACCIDENTE), position = "dodge", fill = as.factor(CLASE_ACCIDENTE))) +
  xlab("Clases de accidentes") + ylab("Número de Accidentes") +
  theme(legend.title=element_blank()) +
  ggtitle("Accidentes viales por clase de accidente")
```

En el gráfico se observa que la categoría choque presenta un número de accidentes superior e inferior en la categoría volcamiento.

```{r}
ggplot(data = datos_listos_final) +
  geom_bar(mapping = aes(as.factor(DIA), position = "dodge", fill = as.factor(DIA))) +xlab("Día de la semana") + ylab("Número de Accidentes") +
  theme(legend.title=element_blank()) +
  ggtitle("Accidentes viales por día de la semana ")
```

Se visualiza que se presenta mayor accidentabilidad los días Martes,Miércoles,jueves y viernes.
Se infiere que el día viernes se presenta mayor accidentabilidad porque comienza fin de semana provocando más movilidad en la ciudad de Medellín y el día domingo disminuye notablemente la accidentabilidad porque muchas personas no laboran.

```{r}
ggplot(data = datos_listos_final) +
  geom_bar(mapping = aes(as.factor(MES), position = "dodge", fill = as.factor(MES))) +
  xlab("Meses") + ylab("Número de Accidentes") +
  theme(legend.title=element_blank()) +
  ggtitle("Accidentes viales por Mes")
```

En el mes de agosto y julio es donde el número de accidentes es superior , en julio esto puede darse por el periodo de vacaciones y en agosto por algunos eventos relacionados con feria de flores.En enero, abril y junio se presenta la menor accidentabilidad.

```{r}
ggplot(data = datos_listos_final) +
  geom_bar(mapping = aes(as.factor(AÑO), position = "dodge", fill = as.factor(AÑO))) +
  xlab("AÑO") + ylab("Número de Accidentes") +
  theme(legend.title=element_blank()) +
  ggtitle("Accidentes viales por Año") 
```

En el año 2016 se presento la mayor accidentabilidad y en el año 2014 se presento una accidentabilidad menor, el 2020 también fue inferior el número de accidentes esta reducción pudo ser provocada por la crisis sanitaria que se afrontaba el mundo por motivos del COVID-19 y se debe tener en cuenta que los registrosen este año solo son hasta el 31 de agosto.

**Datos de entrenamiento y validación**

Los datos de entrenamiento para los modelos predictivos fueron con registro de los año 2014,2015,2016 y 2017. Para validar los modelos se usan los accidentes de los años 2018 y 2019, con el fin de analizar el comportamiento del modelo predictivo en el año 2020.

```{r}
#entreno <- datos_listos_final %>% filter(AÑO<=2017)
#prueba <- datos_listos_final %>% filter(AÑO>2017 & AÑO < 2020)
```

**Agrupamiento de los barrios de medellín según de acuerdo a su accidentabilidad**

**Modelos Predictivos**

















